{% extends "base.html" %} {% block title %}My Schedule{% endblock %} {% block
head %}
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css"
  rel="stylesheet"
/>
<link
  href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  rel="stylesheet"
/>
<link
  href="{{ url_for('static', filename='css/home.css') }}"
  rel="stylesheet"
/>
<link
  href="{{ url_for('static', filename='css/myschedule.css') }}"
  rel="stylesheet"
/>
{% endblock %} {% block content %}
<header
  id="main-header"
  class="navbar navbar-expand-md navbar-light fixed-top"
  style="background: transparent; backdrop-filter: blur(10px)"
>
  <div
    class="container-fluid d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3"
  >
    <div class="col-md-3 mb-2 mb-md-0">
      <a
        href="{{ url_for('home') }}"
        class="d-inline-flex link-body-emphasis text-decoration-none"
      >
        <i class="bi bi-grid" style="font-size: 1.5rem"
          >Smart Course Selection Tool</i
        >
      </a>
    </div>
    <ul class="nav col-12 col-md-auto mb-2 justify-content-center mb-md-0">
      <li>
        <a href="{{ url_for('home') }}" class="nav-link px-2 link-secondary"
          >Home</a
        >
      </li>
      <li>
        <a href="{{ url_for('unit.unit') }}" class="nav-link px-2"
          >Upload Units</a
        >
      </li>
      <li>
        <a href="{{ url_for('My_Schedule') }}" class="nav-link px-2"
          >My Schedule</a
        >
      </li>
      <li>
        <a href="{{ url_for('ShareSchedule') }}" class="nav-link px-2">Share</a>
      </li>
    </ul>
    <div
      class="col-md-3 d-flex align-items-center gap-3 myschedule-dropdown-container"
    >
      {% if current_user.is_authenticated %}
      <div class="dropdown myschedule-dropdown">
        <a
          href="#"
          class="d-flex align-items-center text-white text-decoration-none"
        >
          <span class="me-2">{{ current_user.username }}</span>
          <img
            src="{{ url_for('static', filename='image/avatar.png') }}"
            alt="Avatar"
            class="rounded-circle"
            width="32"
            height="32"
          />
        </a>
        <ul class="dropdown-menu myschedule-dropdown-menu">
          <li>
            <a class="dropdown-item" href="{{ url_for('My_Schedule') }}"
              ><i class="bi bi-calendar me-2"></i>My Schedule</a
            >
          </li>
          <li>
            <a class="dropdown-item" href="{{ url_for('dashboard') }}"
              ><i class="bi bi-person me-2"></i>Profile</a
            >
          </li>
          <li><hr class="dropdown-divider" /></li>
          <li>
            <a class="dropdown-item" href="{{ url_for('logout') }}"
              ><i class="bi bi-box-arrow-right me-2"></i>Logout</a
            >
          </li>
        </ul>
      </div>
      {% else %}
      <a href="{{ url_for('login') }}" class="btn btn-outline-primary me-2"
        >Login</a
      >
      <a href="{{ url_for('register') }}" class="btn btn-primary">Sign Up</a>
      {% endif %}
    </div>
  </div>
</header>
<main class="container flex-grow-1 my-4">
  <h1 class="mb-4">My Schedules</h1>
  <div
    id="delete-success"
    class="alert alert-success text-center d-none"
    role="alert"
  >
    <i class="bi bi-check-circle me-2"></i>delete success!
  </div>
  {% if schedules %} {% for schedule in schedules %}
  <div class="schedule-container mb-5" data-schedule-id="{{ schedule.id }}">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>{{ schedule.name }}</h2>
      <button
        class="btn btn-danger btn-sm delete-schedule"
        data-schedule-id="{{ schedule.id }}"
      >
        <i class="bi bi-trash me-1"></i>Delete
      </button>
    </div>
    <p><strong>Created At:</strong> {{ schedule.created_at }}</p>
    <div class="table-responsive">
      <h3 class="mb-4">Class Times</h3>
      <table class="table table-bordered text-center">
        <thead class="table-light">
          <tr>
            <th>Time</th>
            <th>Monday</th>
            <th>Tuesday</th>
            <th>Wednesday</th>
            <th>Thursday</th>
            <th>Friday</th>
          </tr>
        </thead>
        <tbody id="timetable-body-{{ schedule.id }}"></tbody>
      </table>
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="alert alert-info text-center" role="alert">
    <i class="bi bi-info-circle me-2"></i>
    You haven't created any schedules yet. Please try adding one!
    <a href="{{ url_for('unit.unit') }}" class="btn btn-primary btn-sm mt-3"
      >Adding Classes</a
    >
  </div>
  {% endif %}
</main>
{% endblock %} {% block scripts %}
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="{{ url_for('static', filename='js/home.js') }}"></script>
<script src="{{ url_for('static', filename='js/myschedule.js') }}"></script>
<script>
  const scheduleData = {{ schedules | tojson | safe }};
  $(document).ready(function () {
    $('.delete-schedule').on('click', function () {
      const scheduleId = $(this).data('schedule-id');
      if (confirm('Are you sure you want to delete this schedule?')) {
        $.ajax({
          url: `/schedule/delete/${scheduleId}`,
          type: 'POST',
          success: function (response) {
            if (response.success) {
              $('#delete-success').removeClass('d-none');
              $(`div[data-schedule-id="${scheduleId}"]`).remove();
              if ($('.schedule-container').length === 0) {
                $('main.container').append(`
                  <div class="alert alert-info text-center" role="alert">
                    <i class="bi bi-info-circle me-2"></i>
                    you haven't created any schedules yet. Please try adding one!
                    <a href="{{ url_for('unit.unit') }}" class="btn btn-primary btn-sm mt-3">Adding Classes</a>
                  </div>
                `);
              }
              setTimeout(() => $('#delete-success').addClass('d-none'), 3000);
            } else {
              alert('Deletion failed：' + (response.message || 'Unknown error'));
            }
          },
          error: function () {
            alert('deletion failed：Server error');
          }
        });
      }
    });
  });
</script>
{% endblock %}
